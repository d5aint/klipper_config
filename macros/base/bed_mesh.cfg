[gcode_macro BED_MESH_CALIBRATE]
rename_existing: _BASE_BED_MESH_CALIBRATE
description: Perform Mesh Bed Leveling
gcode:
    {% set verbose = printer["gcode_macro _USER_VARIABLES"].verbose %}

    {% if verbose %}{action_respond_info("Bed Mesh Calibrate")}{% endif %}

    _CG28
    STATUS_LEDS COLOR="meshing"
    ACTIVATE_PROBE

    _BASE_BED_MESH_CALIBRATE {% for p in params %}{'%s=%s ' % (p, params[p])}{% endfor %}
    DEACTIVATE_PROBE
    STATUS_LEDS COLOR="ready"

[gcode_macro QUAD_GANTRY_LEVEL]
rename_existing: _BASE_QUAD_GANTRY_LEVEL
description: Conform a moving, twistable gantry to the shape of a stationary bed
gcode:
    {% set vars = printer["gcode_macro _USER_VARIABLES"] %}
    {% set tilting_travel_accel = vars.tilting_travel_accel %}

    {% if vars.verbose %}{action_respond_info("Quad gantry leveling")}{% endif %}

    _CG28
    STATUS_LEDS COLOR="leveling"
    ACTIVATE_PROBE

    {% set saved_accel = printer.toolhead.max_accel %}
    M204 S{tilting_travel_accel}

    _BASE_QUAD_GANTRY_LEVEL {% for p in params %}{'%s=%s ' % (p, params[p])}{% endfor %}
    SET_VELOCITY_LIMIT ACCEL={saved_accel}
    DEACTIVATE_PROBE
	STATUS_LEDS COLOR="ready"
