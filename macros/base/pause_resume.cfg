[gcode_macro PAUSE]
rename_existing: BASE_PAUSE
description: Pause and park toolhead.
gcode:
    {% set light_intensity_start_print = printer["gcode_macro _USER_VARIABLES"].light_intensity_start_print %}
    {% set safe_extruder_temp = printer["gcode_macro _USER_VARIABLES"].safe_extruder_temp %}
    {% set verbose = printer["gcode_macro _USER_VARIABLES"].verbose %}

    {% if printer.pause_resume.is_paused %}
        RESPOND MSG="Print is already paused"
    {% else %}
        SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=etemp VALUE={printer['extruder'].target}
        SAVE_GCODE_STATE NAME=PAUSE_state
        LIGHT_ON S={light_intensity_start_print}
        
        BASE_PAUSE
        PARK
        
		M104 S{safe_extruder_temp}
		SET_IDLE_TIMEOUT TIMEOUT=7200

        {% if verbose %}
            RESPOND MSG="Paused"
        {% endif %}
    {% endif %}

[gcode_macro RESUME]
rename_existing: BASE_RESUME
description: Resume the print after an optional unretract
variable_etemp: 0
gcode:
    {% set St = printer["gcode_macro _USER_VARIABLES"].travel_speed %}
    {% set light_intensity_printing = printer["gcode_macro _USER_VARIABLES"].light_intensity_printing %}
    {% set verbose = printer["gcode_macro _USER_VARIABLES"].verbose %}
	
    {% if not printer.pause_resume.is_paused %}
        RESPOND MSG="Print is not paused. Resume ignored"
    {% else %}
	    SET_IDLE_TIMEOUT TIMEOUT={printer.configfile.settings.idle_timeout.timeout}
        
		{% if etemp > 0 %}
            M109 S{etemp}
        {% endif %}
		
        RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1 MOVE_SPEED={St}
        
        {% if verbose %}
            RESPOND MSG="Printing"
        {% endif %}
		
		LIGHT_ON S={light_intensity_printing}
        BASE_RESUME
    {% endif %}
